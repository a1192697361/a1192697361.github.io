<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="èœé¸Ÿçš„ Linux æœåŠ¡å™¨ç¼–ç¨‹è®°å½• - C++" />
    <meta name="hexo-theme-A4" content="v1.8.3" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>Fingsinz&#39;s space | é£ä¿¡æ¢“</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
    
   
<link rel="stylesheet" href="/css/lightgallery.min.css">


<meta name="generator" content="Hexo 7.1.1">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head>
    
    <style>
        :root {
            --waline-theme-color: #000000; 
            --waline-color: #000000; 
            --waline-border-color: #000000; 
            --waline-white: #000000; 
            --waline-bgcolor-light: white;  
        }
        body {
            color: #000000;
            background: #bed2bb;
        }
        .post-md code {
            background: #e7f7f3;
            color: #7f688d; 
        }
        .post-md pre, .post-md .highlight {
            background: #e7f7f3;
            color: #7f688d; 
        }
        pre .string, pre .value, pre .inheritance, pre .header, pre .ruby .symbol, pre .xml .cdata {
            color: #000000;
        }
        pre .number, pre .preprocessor, pre .built_in, pre .literal, pre .params, pre .constant {
            color: #000000;
        }
        .year-font-color {
            color: #000000 !important;
        }
        .wl-card span.wl-nick {
            color: #000000; 
        }
        .wl-card .wl-badge {
            border: 1px solid #000000;
            color: #000000; 
        }
        .wl-btn {
            border: 1px solid #000000; 
            color:  #000000;  
        }
        .wl-btn.primary {
            color: white; 
        }
        .wl-header label {
            color: #000000;
        }
        a {
            color: #6b798e;
        }

        .post-md a {
            color: #6b798e;
        }

        .nav li a {
            color: #6b798e;
        }

        .archive-main a:link {
            color: #6b798e;
        }
        .archive-main a:visited {
            color: #6b798e; 
        }

        .archive li span {
            color: #000000;
        }

        .post-main-title {
            color: #000000;
        }

        .post-md h1,
        .post-md h2,
        .post-md h3,
        .post-md h4,
        .post-md h5,
        .post-md h6 {
            color: #000000;
        }

        [data-waline] p {
            color: #000000;
        }
        [data-waline] a {
            color: #000000;
        } 
        .wl-sort li.active {
            color: #000000;
        }

        .wl-card .wl-meta>span {
            background: white;
        }

        .paper {
            background: #bed2bb;
        }

        .index-main {
            background: white;
        }

        .paper-main {
            background: white;
        }

        .wl-panel {
            background: white;
        }

        .archive li:nth-child(odd) {
            background: white;
            ;
        }

        .archive li:nth-child(even) {
            background: white;
        }

        .post-md table tr:nth-child(odd) td {
            background: white;
        }

        .post-md table tr:nth-child(even) td {
            background: white;
        }

    
        .progress-wrap::after {
            color: #000000; /* ç®­å¤´çš„é¢œè‰² */
        }
        .progress-wrap svg.progress-circle path {
	        stroke: #000000; /* è¾¹æ¡†çš„é¢œè‰² */
        }
        .progress-wrap::before {
	        background-image: linear-gradient(298deg, #6b798e, #6b798e); /* é¼ æ ‡æ»‘è¿‡çš„ç®­å¤´é¢œè‰² */
         }

        .return-to-last-progress-wrap::after {
            color: #000000; /* ç®­å¤´çš„é¢œè‰² */
        }
        .return-to-last-progress-wrap svg.progress-circle path {
	        stroke: #000000; /* è¾¹æ¡†çš„é¢œè‰² */
        }
        .return-to-last-progress-wrap::before {
	        background-image: linear-gradient(298deg, #6b798e, #6b798e); /* é¼ æ ‡æ»‘è¿‡çš„ç®­å¤´é¢œè‰² */
         }

         .left-toc-container::-webkit-scrollbar-thumb {
            background-color: #000000; /* è®¾ç½®æ»šåŠ¨æ¡æ‹–åŠ¨å—çš„é¢œè‰² */
        }

        .bs-docs-sidebar .nav>.active>a,
        .bs-docs-sidebar .nav>li>a:hover,
        .bs-docs-sidebar .nav>li>a:focus {
            color: #6b798e;
            border-left-color: #6b798e;
        }
        .bs-docs-sidebar .nav>li>a {
            color:  #000000;
        }
    </style>

    
    <body>
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Fingsinz&#39;s space</a> 
            <span class="description">æˆ‘åœ¨æƒ³ï¼Œæ—¶ä¸‹ä½ æ‰€éœ€è¦çš„ï¼Œåº”è¯¥æ˜¯ç—›ç—›å¿«å¿«æ¢ä¸ªå¿ƒæƒ…ï¼Œå¹²å¹²è„†è„†äº«å—äººç”Ÿã€‚</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µğŸšï¸</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« ğŸ“„</a></li>
            
        
            
                <li><a href="/categories/">åˆ†ç±»ğŸ“</a></li>
            
        
            
                <li><a href="/notes/">ç¬”è®°ğŸ“”</a></li>
            
        
            
                <li><a href="/funny/">è¶£äº‹ğŸ’¡</a></li>
            
        
            
                <li><a href="/about/">å…³äºğŸ§‘</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            èœé¸Ÿçš„ Linux æœåŠ¡å™¨ç¼–ç¨‹è®°å½• - C++
        </div>
      
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B8%80-%E4%BB%8Esocket%E5%BC%80%E5%A7%8B"><span class="post-toc-text">ä¸€ã€ä»socketå¼€å§‹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-1-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%B9%B2%E4%BA%86%E4%BB%80%E4%B9%88"><span class="post-toc-text">1.1 æœåŠ¡ç«¯å¹²äº†ä»€ä¹ˆ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-2-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%A6%82%E4%BD%95%E9%85%8D%E5%90%88"><span class="post-toc-text">1.2 å®¢æˆ·ç«¯å¦‚ä½•é…åˆ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-3-%E8%AF%A5%E8%8A%82%E6%B6%89%E5%8F%8A%E5%87%BD%E6%95%B0%E5%8F%8A%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="post-toc-text">1.3 è¯¥èŠ‚æ¶‰åŠå‡½æ•°åŠæºä»£ç </span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BA%8C-%E5%AE%8C%E5%96%84%E4%BB%A3%E7%A0%81-%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%86%99"><span class="post-toc-text">äºŒã€å®Œå–„ä»£ç ï¼Œæ•°æ®è¯»å†™</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-1-%E9%94%99%E8%AF%AF%E6%A3%80%E6%9F%A5%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="post-toc-text">2.1 é”™è¯¯æ£€æŸ¥å¤„ç†å‡½æ•°</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-2-%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%86%99"><span class="post-toc-text">2.2 æ•°æ®è¯»å†™</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-3-%E8%AF%A5%E8%8A%82%E6%B6%89%E5%8F%8A%E5%87%BD%E6%95%B0%E5%8F%8A%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="post-toc-text">2.3 è¯¥èŠ‚æ¶‰åŠå‡½æ•°åŠæºä»£ç </span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B8%89-%E9%AB%98%E5%B9%B6%E5%8F%91%E4%BD%BF%E7%94%A8epoll"><span class="post-toc-text">ä¸‰ã€é«˜å¹¶å‘ä½¿ç”¨epoll</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-1-%E4%BB%8Eselect-poll%E5%88%B0epoll"><span class="post-toc-text">3.1 ä»selectã€pollåˆ°epoll</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-2-%E5%B0%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%94%B9%E5%86%99%E6%88%90epoll%E7%89%88%E6%9C%AC"><span class="post-toc-text">3.2 å°†æœåŠ¡å™¨æ”¹å†™æˆepollç‰ˆæœ¬</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%9B%9B-%E5%B0%81%E8%A3%85%E6%88%90%E7%B1%BB-%E7%A8%8B%E5%BA%8F%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="post-toc-text">å››ã€å°è£…æˆç±»ï¼Œç¨‹åºæ¨¡å—åŒ–</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-1-%E5%B0%86socket%E5%92%8Cinetaddress%E5%B0%81%E8%A3%85%E6%88%90%E7%B1%BB"><span class="post-toc-text">4.1 å°†socketå’ŒInetAddresså°è£…æˆç±»</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-2-%E5%B0%86epoll%E5%B0%81%E8%A3%85%E6%88%90%E7%B1%BB"><span class="post-toc-text">4.2 å°†epollå°è£…æˆç±»</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-3-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%8F%8A%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="post-toc-text">4.3 ç›®å½•ç»“æ„åŠæºä»£ç </span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BA%94-%E5%90%91%E7%9D%80reactor%E6%A8%A1%E5%BC%8F%E8%BD%AC%E5%8F%98"><span class="post-toc-text">äº”ã€å‘ç€Reactoræ¨¡å¼è½¬å˜</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-1-reactor%E5%92%8Cproactor"><span class="post-toc-text">5.1 Reactorå’ŒProactor</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-2-%E5%8A%A0%E5%85%A5channel%E7%B1%BB"><span class="post-toc-text">5.2 åŠ å…¥Channelç±»</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-3-%E5%8A%A0%E5%85%A5eventloop%E7%B1%BB"><span class="post-toc-text">5.3 åŠ å…¥EventLoopç±»</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-4-%E5%8A%A0%E5%85%A5server%E7%B1%BB"><span class="post-toc-text">5.4 åŠ å…¥Serverç±»</span></a></li></ol></li></ol>
            
        
        <div class=".article-gallery"><p>å…³é”®è¯ï¼šC++ã€Linux</p>
<span id="more"></span>
<hr>
<blockquote>
<p><strong>Referencesï¼š</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/yuesong-feng/30dayMakeCppServer/">30å¤©è‡ªåˆ¶C++æœåŠ¡å™¨</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/yuesong-feng/pine">é…å¥—ç½‘ç»œåº“ pine</a></li>
</ul>
<p><em>Linuxä¸‹æ“ä½œã€‚</em></p>
</blockquote>
<h2 id="ä¸€-ä»socketå¼€å§‹">ä¸€ã€ä»socketå¼€å§‹</h2>
<p>socketï¼Œè¢«ç¿»è¯‘ä¸ºå¥—æ¥å­—ï¼Œå®ƒæ˜¯è®¡ç®—æœºä¹‹é—´è¿›è¡Œé€šä¿¡çš„ä¸€ç§çº¦å®šæˆ–ä¸€ç§æ–¹å¼ã€‚</p>
<ul>
<li>é€šè¿‡ socket è¿™ç§çº¦å®šï¼Œä¸€å°è®¡ç®—æœºå¯ä»¥æ¥æ”¶å…¶ä»–è®¡ç®—æœºçš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥å‘å…¶ä»–è®¡ç®—æœºå‘é€æ•°æ®ã€‚</li>
</ul>
<h3 id="1-1-æœåŠ¡ç«¯å¹²äº†ä»€ä¹ˆ">1.1 æœåŠ¡ç«¯å¹²äº†ä»€ä¹ˆ</h3>
<p>åœ¨æœåŠ¡å™¨ç«¯ï¼Œéœ€è¦å»ºç«‹ä¸€ä¸ª socket å¥—æ¥å­—ï¼Œå¯¹å¤–æä¾›ä¸€ä¸ªç½‘ç»œé€šä¿¡æ¥å£ã€‚</p>
<ul>
<li>åœ¨ Linux ç³»ç»Ÿä¸­è¿™ä¸ªå¥—æ¥å­—ä»…ä»…æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªintç±»å‹çš„å€¼ã€‚</li>
<li>å¯¹å¥—æ¥å­—çš„æ‰€æœ‰æ“ä½œï¼ˆåŒ…æ‹¬åˆ›å»ºï¼‰éƒ½æ˜¯æœ€åº•å±‚çš„ç³»ç»Ÿè°ƒç”¨ã€‚</li>
</ul>
<ol>
<li>åˆ›å»ºå¥—æ¥å­—ï¼š</li>
</ol>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> sockfd = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br></pre></td></tr></tbody></table></figure>
<ol start="2">
<li>åˆ›å»ºä¸€ä¸ª <code>sockaddr_in</code> ç»“æ„ä½“å¹¶åˆå§‹åŒ–ï¼ˆ<code>bzero</code> å‡½æ•°ï¼‰ï¼š</li>
</ol>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> serverAddr;</span><br><span class="line"><span class="built_in">bzero</span>(&amp;serverAddr, <span class="built_in">sizeof</span>(serverAddr));</span><br></pre></td></tr></tbody></table></figure>
<ol start="3">
<li>è®¾ç½®åœ°å€æ—ã€IP åœ°å€å’Œç«¯å£å·ï¼š</li>
</ol>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">serverAddr.sin_family = AF_INET;</span><br><span class="line">serverAddr.sin_addr.s_addr = <span class="built_in">inet_addr</span>(<span class="string">"127.0.0.1"</span>);</span><br><span class="line">serverAddr.sin_port = <span class="built_in">htons</span>(<span class="number">1234</span>);</span><br></pre></td></tr></tbody></table></figure>
<ol start="4">
<li>å°† socket åœ°å€ä¸æ–‡ä»¶æè¿°ç¬¦ç»‘å®šï¼š</li>
</ol>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span>(sockfd, (<span class="keyword">struct</span> sockaddr *)&amp;serverAddr, <span class="built_in">sizeof</span>(serverAddr));</span><br></pre></td></tr></tbody></table></figure>
<ol start="5">
<li>ä½¿ç”¨ <code>listen</code> å‡½æ•°ç›‘å¬å¥—æ¥å­—ï¼š</li>
</ol>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">listen</span>(sockfd, SOMAXCONN);</span><br></pre></td></tr></tbody></table></figure>
<ol start="6">
<li>æœåŠ¡ç«¯æƒ³è¦æ¥å—ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œéœ€è¦ä½¿ç”¨ <code>accept</code> å‡½æ•°ï¼š</li>
</ol>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> clientAddr;</span><br><span class="line"><span class="type">socklen_t</span> clientAddrLen = <span class="built_in">sizeof</span>(clientAddr);</span><br><span class="line"><span class="built_in">bzero</span>(&amp;clientAddr, <span class="built_in">sizeof</span>(clientAddr));</span><br><span class="line"><span class="type">int</span> clientSockfd = <span class="built_in">accept</span>(sockfd, (sockaddr *)&amp;clientAddr, &amp;clientAddrLen);</span><br></pre></td></tr></tbody></table></figure>
<ol start="7">
<li>è¾“å‡º socket è¿æ¥ä¿¡æ¯ï¼š</li>
</ol>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">"Client connected: %d!\tIP: %s\tPort: %d\n"</span>, clientSockfd, <span class="built_in">inet_ntoa</span>(clientAddr.sin_addr), <span class="built_in">ntohs</span>(clientAddr.sin_port));</span><br></pre></td></tr></tbody></table></figure>
<p>è‡³æ­¤ï¼Œå®¢æˆ·ç«¯å·²ç»å¯ä»¥é€šè¿‡ IP åœ°å€å’Œç«¯å£å·è¿æ¥åˆ°è¿™ä¸ª socket ç«¯å£äº†ã€‚</p>
<h3 id="1-2-å®¢æˆ·ç«¯å¦‚ä½•é…åˆ">1.2 å®¢æˆ·ç«¯å¦‚ä½•é…åˆ</h3>
<p>åœ¨å®¢æˆ·ç«¯ï¼Œä¹Ÿéœ€è¦å»ºç«‹ä¸€ä¸ª socket å¥—æ¥å­—ã€‚</p>
<p>å¯¹äºå®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨å­˜åœ¨çš„å”¯ä¸€æ ‡è¯†æ˜¯ IP åœ°å€å’Œç«¯å£å·ã€‚æ­¤æ—¶éœ€è¦å°†å¥—æ¥å­—ç»‘å®šåˆ°ä¸€ä¸ª IP åœ°å€å’Œç«¯å£ä¸Šã€‚</p>
<ol>
<li>åˆ›å»ºå¥—æ¥å­—ï¼š</li>
</ol>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> sockfd = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br></pre></td></tr></tbody></table></figure>
<ol start="2">
<li>åˆ›å»ºä¸€ä¸ª <code>sockaddr_in</code> ç»“æ„ä½“ï¼Œå¹¶ç»‘å®š IP æ—ã€IP åœ°å€å’Œç«¯å£å·ï¼š</li>
</ol>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> serverAddr;</span><br><span class="line"><span class="built_in">bzero</span>(&amp;serverAddr, <span class="built_in">sizeof</span>(serverAddr));</span><br><span class="line">serverAddr.sin_family = AF_INET;</span><br><span class="line">serverAddr.sin_addr.s_addr = <span class="built_in">inet_addr</span>(<span class="string">"127.0.0.1"</span>);</span><br><span class="line">serverAddr.sin_port = <span class="built_in">htons</span>(<span class="number">1234</span>);</span><br></pre></td></tr></tbody></table></figure>
<ol start="3">
<li>ä½¿ç”¨ <code>connect</code> å‡½æ•°è¿›è¡Œè¿æ¥ï¼š</li>
</ol>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(sockfd, (sockaddr *)&amp;serverAddr, <span class="built_in">sizeof</span>(serverAddr));</span><br></pre></td></tr></tbody></table></figure>
<p>æ³¨æ„ï¼Œéœ€è¦å…ˆ <code>./server</code> è¿è¡ŒæœåŠ¡ç«¯è¿›è¡Œç­‰å¾…ï¼Œå† <code>./client</code> è¿è¡Œå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥è¯·æ±‚ã€‚</p>
<h3 id="1-3-è¯¥èŠ‚æ¶‰åŠå‡½æ•°åŠæºä»£ç ">1.3 è¯¥èŠ‚æ¶‰åŠå‡½æ•°åŠæºä»£ç </h3>
<ul>
<li>ç›¸å…³å¤´æ–‡ä»¶ï¼š</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span> <span class="comment">// åˆ›å»º socket æ‰€éœ€</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span>  <span class="comment">// socket åœ°å€ç»“æ„ä½“æ‰€éœ€</span></span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>åˆ›å»º socketï¼š</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">socket</span> <span class="params">(<span class="type">int</span> __domain, <span class="type">int</span> __type, <span class="type">int</span> __protocol)</span></span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* __domainï¼šIP åœ°å€ç±»å‹ï¼ŒAF_INET è¡¨ç¤º IPv4ï¼ŒAF_INET6 è¡¨ç¤º IPv6ã€‚</span></span><br><span class="line"><span class="comment">* __typeï¼šæ•°æ®ä¼ è¾“æ–¹å¼ï¼ŒSOCK_STREAM è¡¨ç¤ºæµæ ¼å¼ã€é¢å‘é“¾æ¥ï¼Œå¤šç”¨äº TCPï¼› SOCK_DGRAM è¡¨ç¤ºæ•°æ®æŠ¥æ ¼å¼ã€æ— è¿æ¥ï¼Œå¤šç”¨äº UDPã€‚</span></span><br><span class="line"><span class="comment">* __protocolï¼šåè®®ï¼Œ0 è¡¨ç¤ºæ ¹æ®å‰é¢ä¸¤ä¸ªå‚æ•°è‡ªåŠ¨æ¨å¯¼åè®®ç±»å‹ã€‚è®¾ç½®ä¸º IPPROTO_TCP å’Œ IPPROTO_UDPï¼Œåˆ†åˆ«è¡¨ç¤º TCP å’Œ UDPã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>åˆå§‹åŒ–ï¼š</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">bzero</span> <span class="params">(<span class="type">void</span> *__s, <span class="type">size_t</span> __n)</span></span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* __sï¼šæŒ‡å‘è¦æ¸…é›¶çš„å†…å­˜å—çš„æŒ‡é’ˆã€‚</span></span><br><span class="line"><span class="comment">* __nï¼šè¦æ¸…é›¶çš„å†…å­˜å—çš„å¤§å°ã€‚</span></span><br><span class="line"><span class="comment">* è¯¥å‡½æ•°åœ¨å¤´æ–‡ä»¶ string.h æˆ– cstring ä¸­ã€‚</span></span><br><span class="line"><span class="comment">* Effective C++ - æ¡æ¬¾01ï¼šè§† C++ ä¸ºä¸€ä¸ªè¯­è¨€è”é‚¦ã€‚å†™ C å°±ç”¨ string.hï¼Œå†™ C++ å°±ç”¨ cstringã€‚</span></span><br><span class="line"><span class="comment">* Effective C++ - æ¡æ¬¾04ï¼šç¡®å®šå¯¹è±¡è¢«ä½¿ç”¨å‰å·²å…ˆè¢«åˆå§‹åŒ–ã€‚ä½¿ç”¨ bzero è¿›è¡Œåˆå§‹åŒ–ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>ç»‘å®šå‡½æ•°ï¼š</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">bind</span> <span class="params">(<span class="type">int</span> __fd, __CONST_SOCKADDR_ARG __addr, <span class="type">socklen_t</span> __len)</span></span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* __fdï¼šæ–‡ä»¶æè¿°ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">* __addrï¼šsockaddr å‚æ•°ã€‚</span></span><br><span class="line"><span class="comment">* __lenï¼šsockaddr å‚æ•°çš„å¤§å°ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>listen</code> å‡½æ•°ï¼š</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">listen</span> <span class="params">(<span class="type">int</span> __fd, <span class="type">int</span> __n)</span></span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* __fdï¼šæ–‡ä»¶æè¿°ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">* __nï¼šæœ€å¤§ç›‘å¬é˜Ÿåˆ—é•¿åº¦ï¼Œå®å®šä¹‰ SOMAXCONN ä¸ºæœ€å¤§å€¼ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>accept</code> å‡½æ•°ï¼š</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">accept</span> <span class="params">(<span class="type">int</span> __fd, __SOCKADDR_ARG __addr, <span class="type">socklen_t</span> *__restrict __addr_len)</span></span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* __fdï¼šæœåŠ¡ç«¯çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">* __addr`ï¼šsockaddr å‚æ•°ã€‚</span></span><br><span class="line"><span class="comment">* __addr_len`ï¼šæŒ‡å‘ sockaddr å‚æ•°å¤§å°çš„æŒ‡é’ˆã€‚å› ä¸º accept éœ€è¦å†™å…¥å®¢æˆ·ç«¯ socket é•¿åº¦ï¼Œæ‰€ä»¥éœ€è¦åœ°å€</span></span><br><span class="line"><span class="comment">* å¦å¤–ï¼Œè¯¥å‡½æ•°ä¼šé˜»å¡å½“å‰ç¨‹åºï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯ socket è¢«æ¥å—åç¨‹åºæ‰ä¼šå¾€ä¸‹æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>connect</code> å‡½æ•°ï¼š</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">connect</span> <span class="params">(<span class="type">int</span> __fd, __CONST_SOCKADDR_ARG __addr, <span class="type">socklen_t</span> __len)</span></span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* __fdï¼šå®¢æˆ·ç«¯çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">* __addrï¼šsockaddr å‚æ•°ã€‚</span></span><br><span class="line"><span class="comment">* __lenï¼šsockaddr å‚æ•°å¤§å°ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>
<p>è¯¥èŠ‚ä»£ç ï¼š<a target="_blank" rel="noopener" href="https://github.com/Fingsinz/MakeServerInLinux/tree/master/Day1">Github</a>ï¼Œ<a target="_blank" rel="noopener" href="https://gitee.com/fingsinz/make-server-in-linux/tree/master/Day1">Gitee</a></p>
<h2 id="äºŒ-å®Œå–„ä»£ç -æ•°æ®è¯»å†™">äºŒã€å®Œå–„ä»£ç ï¼Œæ•°æ®è¯»å†™</h2>
<p>ä¸Šé¢çš„ä»£ç æ˜¯åŸºç¡€ç‰ˆçš„ï¼Œä½†è¦æƒ³çœŸæ­£è¿è¡Œä½¿ç”¨ï¼Œéœ€è¦å®Œå–„ä»£ç ï¼Œå¹¶æŠ“ä½é”™è¯¯ã€‚</p>
<ul>
<li>Effective C++ ä¸­æœ‰æåˆ°ï¼šâ€œåˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°â€ï¼ˆæ¡æ¬¾08ï¼‰ã€‚</li>
</ul>
<h3 id="2-1-é”™è¯¯æ£€æŸ¥å¤„ç†å‡½æ•°">2.1 é”™è¯¯æ£€æŸ¥å¤„ç†å‡½æ•°</h3>
<p>å¯¹äº Linux ç³»ç»Ÿè°ƒç”¨ï¼Œå¸¸è§çš„é”™è¯¯æç¤ºæ–¹å¼æ˜¯ä½¿ç”¨è¿”å›å€¼å’Œè®¾ç½®é”™è¯¯ç ã€‚</p>
<ul>
<li>å½“ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨è¿”å› <code>-1</code>ï¼Œè¯´æ˜æœ‰é”™è¯¯å‘ç”Ÿã€‚</li>
</ul>
<p>å¢åŠ ä¸€ä¸ªé”™è¯¯æ£€æŸ¥å¤„ç†å‡½æ•°ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">errorif</span><span class="params">(<span class="type">bool</span> condition, <span class="type">const</span> <span class="type">char</span> *errmsg)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (condition)</span><br><span class="line">	{</span><br><span class="line">		<span class="built_in">perror</span>(errmsg);</span><br><span class="line">		<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºåˆ¤æ–­æ˜¯å¦å‘ç”Ÿé”™è¯¯æ¡ä»¶ï¼Œè°ƒç”¨ <code>iostream</code> ä¸­çš„ <code>perror</code> æ‰“å°é”™è¯¯ã€‚</li>
<li>ç¬¬äºŒä¸ªå‚æ•°ä¸ºé”™è¯¯ä¿¡æ¯ã€‚</li>
<li>ç„¶åä½¿ç”¨ <code>exit</code> å‡½æ•°è®©ç¨‹åºé€€å‡ºå¹¶è¿”å›ä¸€ä¸ªé¢„å®šä¹‰å¸¸é‡ <code>EXIT_FAILURE</code>ã€‚</li>
</ul>
<p>ä½¿ç”¨å°±å¾ˆæ–¹ä¾¿ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> sockfd = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">errorif</span>(sockfd == <span class="number">-1</span>, <span class="string">"socket create error"</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>å¯¹æ‰€æœ‰å‡½æ•°éƒ½è¿›è¡Œå¤„ç†é”™è¯¯ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">errorif</span>(<span class="built_in">bind</span>(sockfd, (<span class="keyword">struct</span> sockaddr *)&amp;serverAddr, <span class="built_in">sizeof</span>(serverAddr)) == <span class="number">-1</span>, <span class="string">"socket bind error"</span>);</span><br><span class="line"><span class="built_in">errorif</span>(<span class="built_in">listen</span>(sockfd, SOMAXCONN) == <span class="number">-1</span>, <span class="string">"socket listen error"</span>);</span><br><span class="line"><span class="built_in">errorif</span>(clientfd == <span class="number">-1</span>, <span class="string">"socket accept error"</span>);</span><br><span class="line"><span class="built_in">errorif</span>(<span class="built_in">connect</span>(sockfd, (<span class="keyword">struct</span> sockaddr *)&amp;serverAddr, <span class="built_in">sizeof</span>(serverAddr)) == <span class="number">-1</span>, <span class="string">"socket connect error"</span>);</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><em>é”™è¯¯çš„å¤„ç†æ˜¯å¿…é¡»çš„ï¼Œä½†å¤„ç†å‡½æ•°ä¸ä¸€å®šè¿™æ ·å†™ã€‚</em></li>
</ul>
<h3 id="2-2-æ•°æ®è¯»å†™">2.2 æ•°æ®è¯»å†™</h3>
<p>å½“å»ºç«‹ socket è¿æ¥åï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>unistd.h</code> ä¸­çš„ <code>read</code> å’Œ <code>write</code> å‡½æ•°è¿›è¡Œæ•°æ®è¯»å†™ã€‚ï¼ˆä»…é™äº TCP è¿æ¥ã€‚UDP è¿æ¥ä½¿ç”¨ <code>sendto</code> å’Œ <code>recvfrom</code> å‡½æ•°ã€‚ï¼‰</p>
<p>æ¥ä¸‹æ¥åšä¸€ä¸ªé€šä¿¡æƒ…å†µï¼šå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€å®šæ•°æ®ï¼Œç„¶åæœåŠ¡ç«¯æ¥æ”¶åè½¬å‘å›å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°†æ¥æ”¶çš„è½¬å‘æ•°æ®å†è¿›è¡Œæ ‡å‡†è¾“å‡ºã€‚</p>
<p>å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)	<span class="comment">// æŒç»­é€šä¿¡</span></span><br><span class="line">{</span><br><span class="line">	<span class="type">char</span> buffer[<span class="number">1024</span>];	<span class="comment">// å®šä¹‰ç¼“å†²åŒº</span></span><br><span class="line">	std::cin &gt;&gt; buffer;	<span class="comment">// ä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// å‘æœåŠ¡ç«¯å‘é€æ•°æ®</span></span><br><span class="line">	<span class="type">size_t</span> writeLen = <span class="built_in">write</span>(sockfd, buffer, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å‘é€å¤±è´¥å¤„ç†</span></span><br><span class="line">	<span class="keyword">if</span> (writeLen == <span class="number">-1</span>)</span><br><span class="line">	{</span><br><span class="line">		std::cout &lt;&lt; <span class="string">"Socket already disconnected!\n"</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="built_in">bzero</span>(buffer, <span class="built_in">sizeof</span>(buffer));	<span class="comment">// æ¸…ç©ºç¼“å†²åŒº</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// è¯»å›æ•°æ®</span></span><br><span class="line">	<span class="type">size_t</span> readLen = <span class="built_in">read</span>(sockfd, buffer, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è¯»æ•°æ®é—®é¢˜åˆ¤æ–­</span></span><br><span class="line">	<span class="keyword">if</span> (readLen &gt; <span class="number">0</span>)</span><br><span class="line">	{</span><br><span class="line">		std::cout &lt;&lt; buffer &lt;&lt; <span class="string">"\n"</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (readLen == <span class="number">0</span>)</span><br><span class="line">	{</span><br><span class="line">		std::cout &lt;&lt; <span class="string">"Server socket disconnected!\n"</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (readLen == <span class="number">-1</span>)</span><br><span class="line">	{</span><br><span class="line">		<span class="built_in">close</span>(sockfd);</span><br><span class="line">		<span class="built_in">errorif</span>(<span class="literal">true</span>, <span class="string">"socket read error"</span>);</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æœåŠ¡ç«¯ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">{</span><br><span class="line">	<span class="comment">// å®šä¹‰å¹¶åˆå§‹åŒ–ç¼“å†²åŒº</span></span><br><span class="line">	<span class="type">char</span> buffer[<span class="number">1024</span>];</span><br><span class="line">	<span class="built_in">bzero</span>(buffer, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä»å®¢æˆ·ç«¯è¯»å–æ•°æ®</span></span><br><span class="line">	<span class="type">size_t</span> readLen = <span class="built_in">read</span>(clientfd, buffer, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è¯»å–æ•°æ®é—®é¢˜åˆ¤æ–­</span></span><br><span class="line">	<span class="keyword">if</span> (readLen &gt; <span class="number">0</span>)</span><br><span class="line">	{</span><br><span class="line">		std::cout &lt;&lt; <span class="string">"Message from client:"</span> &lt;&lt; clientfd &lt;&lt; <span class="string">": "</span> &lt;&lt; buffer &lt;&lt; <span class="string">"\n"</span>;</span><br><span class="line">		<span class="built_in">write</span>(clientfd, buffer, <span class="built_in">sizeof</span>(buffer));	<span class="comment">// è¯»åˆ°åè½¬å›å®¢æˆ·ç«¯</span></span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (readLen == <span class="number">0</span>)</span><br><span class="line">	{</span><br><span class="line">		std::cout &lt;&lt; <span class="string">"Client "</span> &lt;&lt; clientfd &lt;&lt; <span class="string">" disconnected\n"</span>;</span><br><span class="line">		<span class="built_in">close</span>(clientfd);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (readLen == <span class="number">-1</span>)</span><br><span class="line">	{</span><br><span class="line">		<span class="built_in">close</span>(clientfd);</span><br><span class="line">		<span class="built_in">errorif</span>(<span class="literal">true</span>, <span class="string">"socket read error"</span>);</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>
<ul>
<li>æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½å¯ä»¥ä»å¯¹æ–¹ä¸­è¯»å†™æ•°æ®ã€‚</li>
<li>ä½¿ç”¨å®Œä¸€ä¸ª <code>fd</code>ï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰ åï¼Œè®°å¾—ä½¿ç”¨ <code>close</code> å‡½æ•°è¿›è¡Œå…³é—­ã€‚</li>
</ul>
<h3 id="2-3-è¯¥èŠ‚æ¶‰åŠå‡½æ•°åŠæºä»£ç ">2.3 è¯¥èŠ‚æ¶‰åŠå‡½æ•°åŠæºä»£ç </h3>
<ul>
<li>ç›¸å…³å¤´æ–‡ä»¶ï¼š</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span>	<span class="comment">// è¯»å†™æ•°æ®ç­‰éœ€è¦</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"util.h"</span>  	<span class="comment">// æ”¾ç½®é”™è¯¯å¤„ç†å‡½æ•°</span></span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>write</code> å‡½æ•°ï¼š</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">ssize_t</span> <span class="title">write</span> <span class="params">(<span class="type">int</span> __fd, <span class="type">const</span> <span class="type">void</span> *__buf, <span class="type">size_t</span> __n)</span></span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* __fdï¼šæ–‡ä»¶æè¿°ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">* __bufï¼šå†™å…¥ç¼“å†²åŒºã€‚</span></span><br><span class="line"><span class="comment">* __nï¼šå†™å…¥ç¼“å†²åŒºå¤§å°ã€‚</span></span><br><span class="line"><span class="comment">* è¿”å›å†™å…¥çš„å¤§å°ï¼Œæˆ–-1ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>read</code> å‡½æ•°ï¼š</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">ssize_t</span> <span class="title">read</span> <span class="params">(<span class="type">int</span> __fd, <span class="type">void</span> *__buf, <span class="type">size_t</span> __nbytes)</span></span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* __fdï¼šæ–‡ä»¶æè¿°ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">* __bufï¼šè¯»å–ç¼“å†²åŒºã€‚</span></span><br><span class="line"><span class="comment">* __nbytesï¼šè¯»å–ç¼“å†²åŒºå¤§å°ã€‚</span></span><br><span class="line"><span class="comment">* è¿”å›è¯»å–çš„å¤§å°ï¼Œ-1è¡¨ç¤ºé”™è¯¯ï¼Œ0è¡¨ç¤ºEOFã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>close</code> å‡½æ•°ï¼š</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">close</span> <span class="params">(<span class="type">int</span> __fd)</span></span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* __fdï¼šæ–‡ä»¶æè¿°ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>
<p>è¯¥èŠ‚ä»£ç ï¼š<a target="_blank" rel="noopener" href="https://github.com/Fingsinz/MakeServerInLinux/tree/master/Day2">Github</a>ï¼Œ<a target="_blank" rel="noopener" href="https://gitee.com/fingsinz/make-server-in-linux/tree/master/Day2">Gitee</a></p>
<h2 id="ä¸‰-é«˜å¹¶å‘ä½¿ç”¨epoll">ä¸‰ã€é«˜å¹¶å‘ä½¿ç”¨epoll</h2>
<p>ä¹‹å‰åªå†™äº†ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ï¼Œåªèƒ½åŒæ—¶å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚äº‹å®ä¸Šï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½æ˜¯é«˜å¹¶å‘çš„ï¼Œå¯ä»¥åŒæ—¶ä¸ºæˆåƒä¸Šä¸‡ä¸ªå®¢æˆ·ç«¯æä¾›æœåŠ¡â€”â€”IOå¤ç”¨ã€‚</p>
<ul>
<li>IO å¤ç”¨å’Œå¤šçº¿ç¨‹ç›¸ä¼¼ï¼Œä½†ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µã€‚
<ul>
<li>IO å¤ç”¨é’ˆå¯¹ IO æ¥å£ï¼›</li>
<li>å¤šçº¿ç¨‹é’ˆå¯¹ CPUã€‚</li>
</ul>
</li>
</ul>
<p>IO å¤ç”¨çš„åŸºæœ¬æ€æƒ³æ˜¯äº‹ä»¶é©±åŠ¨ï¼ŒæœåŠ¡å™¨åŒæ—¶ä¿æŒå¤šä¸ªå®¢æˆ·ç«¯ IO è¿æ¥ã€‚</p>
<ul>
<li>å½“ IO ä¸Šæœ‰å¯è¯»æˆ–å¯å†™äº‹ä»¶å‘ç”Ÿï¼Œè¡¨ç¤ºè¿™ä¸ª IO å¯¹åº”çš„å®¢æˆ·ç«¯åœ¨è¯·æ±‚æœåŠ¡å™¨çš„æœåŠ¡ï¼ŒæœåŠ¡å™¨åº”å½“å“åº”ã€‚</li>
<li>Linux ä¸­ï¼Œ IO å¤ç”¨ä½¿ç”¨ selectã€poll å’Œ epoll æ¥å®ç°ã€‚
<ul>
<li>epoll ç›¸æ¯” selectã€pollï¼Œè¡¨ç°æ€§èƒ½æ›´å¥½ï¼Œæ›´åŠ é«˜æ•ˆã€‚</li>
</ul>
</li>
</ul>
<h3 id="3-1-ä»select-pollåˆ°epoll">3.1 ä»selectã€pollåˆ°epoll</h3>
<blockquote>
<p>ä»å®ç°åŸç†ä¸Šæ¥è¯´ï¼Œselect å’Œ poll é‡‡ç”¨çš„éƒ½æ˜¯è½®è¯¢çš„æ–¹å¼ï¼Œå³æ¯æ¬¡è°ƒç”¨éƒ½è¦æ‰«ææ•´ä¸ªæ³¨å†Œæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œå¹¶å°†å…¶ä¸­å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦è¿”å›ç»™ç”¨æˆ·ç¨‹åºï¼Œå› æ­¤å®ƒä»¬æ£€æµ‹å°±ç»ªäº‹ä»¶çš„ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span>ã€‚epoll_wait åˆ™ä¸åŒï¼Œå®ƒé‡‡ç”¨çš„æ˜¯å›è°ƒçš„æ–¹å¼ã€‚å†…æ ¸æ£€æµ‹åˆ°å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œå°†è§¦å‘å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°å°±å°†è¯¥æ–‡ä»¶æè¿°ç¬¦ä¸Šå¯¹åº”çš„äº‹ä»¶æ’äººå†…æ ¸å°±ç»ªäº‹ä»¶é˜Ÿåˆ—ã€‚å†…æ ¸æœ€ååœ¨é€‚å½“çš„æ—¶æœºå°†è¯¥å°±ç»ªäº‹ä»¶é˜Ÿåˆ—ä¸­çš„å†…å®¹æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚å› æ­¤ epoll_wait æ— é¡»è½®è¯¢æ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆæ¥æ£€æµ‹å“ªäº›äº‹ä»¶å·²ç»å°±ç»ªï¼Œå…¶ç®—æ³•æ—¶é—´å¤æ‚åº¦æ˜¯ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>ã€‚è¯¦è§ã€ŠLinuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹-æ¸¸åŒï¼Œç¬¬9ç« ã€‹</p>
</blockquote>
<ul>
<li>å½“æ´»åŠ¨è¿æ¥æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œepoll_wait çš„æ•ˆç‡æœªå¿…æ¯” select å’Œ poll é«˜ï¼Œå› ä¸ºæ­¤æ—¶å›è°ƒå‡½æ•°è¢«è§¦å‘å¾—è¿‡äºé¢‘ç¹ã€‚æ‰€ä»¥ epoll_wait é€‚ç”¨äºè¿æ¥æ•°é‡å¤šï¼Œä½†æ´»åŠ¨è¿æ¥è¾ƒå°‘çš„æƒ…å†µã€‚</li>
</ul>
<p>epoll æ˜¯ Linux ç‰¹æœ‰çš„ IO å¤ç”¨å‡½æ•°ã€‚</p>
<ul>
<li>ä½¿ç”¨ä¸€ç»„å‡½æ•°å®Œæˆä»»åŠ¡ã€‚</li>
<li>æŠŠç”¨æˆ·å…³å¿ƒçš„æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„äº‹ä»¶æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ã€‚
<ul>
<li>è€Œä¸åƒ select å’Œ poll é‚£æ ·æ¯æ¬¡è°ƒç”¨éƒ½é‡å¤ä¼ å…¥æ–‡ä»¶æè¿°ç¬¦æˆ–äº‹ä»¶é›†ã€‚</li>
</ul>
</li>
<li>éœ€è¦é¢å¤–çš„æ–‡ä»¶æè¿°ç¬¦æ¥æ ‡è¯†å†…æ ¸ä¸­çš„äº‹ä»¶è¡¨ã€‚</li>
</ul>
<p>åˆ›å»ºæ–‡ä»¶æè¿°ç¬¦ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">epoll_create</span><span class="params">(<span class="type">int</span> size)</span></span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* sizeï¼šå†…æ ¸äº‹ä»¶è¡¨å¤§å°ã€‚</span></span><br><span class="line"><span class="comment">* è¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œç”¨ä½œå…¶ä»–æ‰€æœ‰ epoll ç³»ç»Ÿè°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å®šè®¿é—®çš„å†…æ ¸äº‹ä»¶è¡¨ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ“ä½œ epoll çš„å†…æ ¸äº‹ä»¶è¡¨ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">epoll_ctl</span><span class="params">(<span class="type">int</span> epfd, <span class="type">int</span> op, <span class="type">int</span> fd, <span class="keyword">struct</span> epoll_event *event)</span></span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* epfdï¼šæ–‡ä»¶æè¿°ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">* opï¼šæ“ä½œç±»å‹ã€‚æœ‰ EPOLL_CTL_ADDï¼ˆå¾€äº‹ä»¶è¡¨ä¸­æ³¨å†Œ fd ä¸Šçš„äº‹ä»¶ï¼‰ã€ </span></span><br><span class="line"><span class="comment">* 				EPOLL_CTL_DELï¼ˆä¿®æ”¹ fd ä¸Šçš„æ³¨å†Œäº‹ä»¶ï¼‰ã€</span></span><br><span class="line"><span class="comment">* 				EPOLL_CTL_MODï¼ˆåˆ é™¤ fd ä¸Šçš„æ³¨å†Œäº‹ä»¶ï¼‰ ä¸‰ç§ã€‚</span></span><br><span class="line"><span class="comment">* fdï¼šæ–‡ä»¶æè¿°ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">* eventï¼šæŒ‡å®šäº‹ä»¶ï¼Œæ˜¯ epoll_event ç»“æ„ä½“æŒ‡é’ˆã€‚</span></span><br><span class="line"><span class="comment">* è¿”å›å€¼ï¼šæˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1 å¹¶è®¾ç½®é”™è¯¯ç ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>
<p>è€Œå…³äº <code>epoll_event</code> ç»“æ„ä½“çš„å®šä¹‰ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">epoll_event</span></span><br><span class="line">{</span><br><span class="line">	<span class="type">__uint32_t</span> events;	<span class="comment">/*epolläº‹ä»¶*/</span></span><br><span class="line">	<span class="type">epoll_data_t</span> data;	<span class="comment">/*ç”¨æˆ·æ•°æ®*/</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">union</span> <span class="title class_">epoll_data</span></span><br><span class="line">{</span><br><span class="line">	<span class="type">void</span> *ptr;		<span class="comment">// æŒ‡å®šä¸fdç›¸å…³çš„ç”¨æˆ·æ•°æ®</span></span><br><span class="line">	<span class="type">int</span> fd;			<span class="comment">// æŒ‡å®šäº‹ä»¶æ‰€ä»å±çš„ç›®æ ‡æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">	<span class="type">uint32_t</span> u32;</span><br><span class="line">	<span class="type">uint64_t</span> u64;</span><br><span class="line">} <span class="type">epoll_data_t</span>;</span><br></pre></td></tr></tbody></table></figure>
<p>epoll ç³»åˆ—ç³»ç»Ÿè°ƒç”¨çš„ä¸»è¦æ¥å£æ˜¯ <code>epoll_wait</code> å‡½æ•°ï¼Œå®ƒåœ¨ä¸€æ®µè¶…æ—¶æ—¶é—´å†…ç­‰å¾…ä¸€ç»„æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„äº‹ä»¶ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">epoll_wait</span><span class="params">(<span class="type">int</span> epfd, <span class="keyword">struct</span> epoll_event *events, <span class="type">int</span> maxevents, <span class="type">int</span> timeout)</span></span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* è¯¥å‡½æ•°å¦‚æœæ£€æµ‹åˆ°äº‹ä»¶ï¼Œå°±å°†æ‰€æœ‰å°±ç»ªçš„äº‹ä»¶ä»å†…æ ¸äº‹ä»¶è¡¨ï¼ˆepfdæŒ‡å®šï¼‰ä¸­å¤åˆ¶åˆ°eventsä¸­ã€‚</span></span><br><span class="line"><span class="comment">* epfdï¼šæ–‡ä»¶æè¿°ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">* eventsï¼šäº‹ä»¶æ•°ç»„ã€‚</span></span><br><span class="line"><span class="comment">* maxeventsï¼šç›‘å¬äº‹ä»¶æ•°ç»„å¤§å°ã€‚</span></span><br><span class="line"><span class="comment">* timeoutï¼šè¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚</span></span><br><span class="line"><span class="comment">* è¿”å›å€¼ï¼šæˆåŠŸè¿”å›å°±ç»ªäº‹ä»¶ä¸ªæ•°ï¼Œå¤±è´¥è¿”å› -1 å¹¶è®¾ç½®é”™è¯¯ç ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>
<p>epoll å¯¹æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œæœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>LTï¼ˆLevel Triggerï¼Œç”µå¹³è§¦å‘ï¼‰æ¨¡å¼
<ul>
<li>é»˜è®¤çš„å·¥ä½œæ¨¡å¼ï¼Œç›¸å½“äºæ•ˆç‡è¾ƒé«˜çš„ pollã€‚</li>
<li>å¯¹äºé‡‡ç”¨ LT å·¥ä½œæ¨¡å¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå½“ epoll_wait æ£€æµ‹åˆ°å…¶ä¸Šæœ‰äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºåï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚è¿™æ ·ï¼Œå½“åº”ç”¨ç¨‹åºä¸‹ä¸€æ¬¡è°ƒç”¨ epoll,_wait æ—¶ï¼Œepoll_wait è¿˜ä¼šå†æ¬¡å‘åº”ç”¨ç¨‹åºé€šå‘Šæ­¤äº‹ä»¶ï¼Œç›´åˆ°è¯¥äº‹ä»¶è¢«å¤„ç†ã€‚</li>
</ul>
</li>
<li>ETï¼ˆEdge Triggerï¼Œè¾¹æ²¿è§¦å‘ï¼‰æ¨¡å¼
<ul>
<li>å¯¹äºé‡‡ç”¨ETå·¥ä½œæ¨¡å¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå½“ epoll_wait æ£€æµ‹åˆ°å…¶ä¸Šæœ‰äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºåï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ç«‹å³å¤„ç†è¯¥äº‹ä»¶ï¼Œå› ä¸ºåç»­çš„epoll_wait è°ƒç”¨å°†ä¸å†å‘åº”ç”¨ç¨‹åºé€šçŸ¥è¿™ä¸€äº‹ä»¶ã€‚å¯è§ï¼ŒET æ¨¡å¼åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šé™ä½äº†åŒä¸€ä¸ª epoll äº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯” LT æ¨¡å¼é«˜ã€‚</li>
<li>ET æ¨¡å¼å¿…é¡»æ­é…éé˜»å¡å¼ socket ä½¿ç”¨ã€‚</li>
</ul>
</li>
</ul>
<p>epoll çš„äº‹ä»¶æœ‰ï¼š</p>
<ul>
<li><code>EPOLLIN</code>ï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯è¯»ï¼ˆåŒ…æ‹¬å¯¹ç«¯ socket æ­£å¸¸å…³é—­ï¼‰ï¼›</li>
<li><code>EPOLLOUT</code>ï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯å†™ï¼›</li>
<li><code>EPOLLPRI</code>ï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦æœ‰ç´§æ€¥çš„æ•°æ®å¯è¯»ï¼ˆè¡¨ç¤ºæœ‰å¸¦å¤–æ•°æ®åˆ°æ¥ï¼‰ï¼›</li>
<li><code>EPOLLERR</code>ï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿé”™è¯¯ï¼›</li>
<li><code>EPOLLHUP</code>ï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦è¢«æŒ‚æ–­ï¼›</li>
<li><code>EPOLLET</code>ï¼šå°† epoll è®¾ä¸ºè¾¹ç¼˜è§¦å‘æ¨¡å¼ã€‚</li>
<li><code>EPOLLONESHOT</code>ï¼šåªç›‘å¬ä¸€æ¬¡äº‹ä»¶ï¼Œå½“ç›‘å¬å®Œäº‹ä»¶åï¼Œå¦‚æœè¿˜éœ€è¦ç»§ç»­ç›‘å¬è¿™ä¸ª socket çš„æƒ…å†µä¸‹ï¼Œéœ€è¦å†æ¬¡æŠŠè¿™ä¸ª socket åŠ åˆ° epoll é˜Ÿåˆ—é‡Œã€‚</li>
</ul>
<h3 id="3-2-å°†æœåŠ¡å™¨æ”¹å†™æˆepollç‰ˆæœ¬">3.2 å°†æœåŠ¡å™¨æ”¹å†™æˆepollç‰ˆæœ¬</h3>
<p>åœ¨åˆ›å»ºäº†æœåŠ¡å™¨ socket fd åï¼Œå°†è¿™ä¸ª fd æ·»åŠ åˆ° epollã€‚</p>
<ul>
<li>epoll ç›‘å¬äº‹ä»¶çš„æè¿°ç¬¦ä¼šæ”¾åœ¨ä¸€æ£µçº¢é»‘æ ‘ä¸Šï¼Œå°†è¦ç›‘å¬çš„ IO å£æ”¾å…¥ epoll çº¢é»‘æ ‘ä¸­ï¼Œå°±å¯ä»¥ç›‘å¬è¯¥ IO ä¸Šçš„äº‹ä»¶ã€‚</li>
<li>åªè¦è¿™ä¸ª fd ä¸Šå‘ç”Ÿå¯è¯»äº‹ä»¶ï¼Œè¡¨ç¤ºæœ‰ä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯è¿æ¥ã€‚</li>
<li>ç„¶å accept è¿™ä¸ªå®¢æˆ·ç«¯å¹¶å°†å®¢æˆ·ç«¯çš„ socket fd æ·»åŠ åˆ° epollï¼Œepoll ä¼šç›‘å¬å®¢æˆ·ç«¯ socket fd æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œå¦‚æœå‘ç”Ÿåˆ™å¤„ç†äº‹ä»¶ã€‚</li>
</ul>
<p>æ‰€ä»¥æœåŠ¡å™¨å¤§æ¦‚çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»º epollï¼ŒåŒæ—¶å®šä¹‰äº‹ä»¶æ•°ç»„ã€‚</li>
</ol>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»º epoll</span></span><br><span class="line"><span class="type">int</span> epfd = <span class="built_in">epoll_create1</span>(<span class="number">0</span>);</span><br><span class="line"><span class="built_in">errorif</span>(epfd == <span class="number">-1</span>, <span class="string">"epoll create error"</span>);</span><br><span class="line"><span class="comment">// å®šä¹‰äº‹ä»¶æ•°ç»„</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">epoll_event</span> events[MAX_EVENTS], ev;</span><br><span class="line"><span class="built_in">bzero</span>(&amp;events, <span class="built_in">sizeof</span>(events));</span><br></pre></td></tr></tbody></table></figure>
<ol start="2">
<li>å°†è¦ç›‘å¬çš„ IO å£æ”¾å…¥ epoll ä¸­ã€‚</li>
</ol>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ev.data.fd = sockfd;			<span class="comment">// è¯¥ IO å£ä¸ºæœåŠ¡å™¨ socket fd</span></span><br><span class="line">ev.events = EPOLLIN;			<span class="comment">// å¯è¯»</span></span><br><span class="line"><span class="built_in">setnonblocking</span>(sockfd);			<span class="comment">// è®¾ç½® sockfd ä¸ºéé˜»å¡</span></span><br><span class="line"><span class="comment">// å°†æœåŠ¡å™¨ socket fd æ³¨å†Œåˆ° epoll</span></span><br><span class="line"><span class="built_in">epoll_ctl</span>(epfd, EPOLL_CTL_ADD, sockfd, &amp;ev);</span><br></pre></td></tr></tbody></table></figure>
<ol start="3">
<li>
<p>ä¸æ–­ç›‘å¬ epoll ä¸Šçš„äº‹ä»¶å¹¶å¤„ç†ã€‚</p>
</li>
<li>
<p>å¦‚æœç›‘å¬å‘ç”Ÿçš„äº‹ä»¶æ˜¯æœåŠ¡å™¨ socket fd ä¸Šçš„äº‹ä»¶ï¼Œè¡¨ç¤ºæœ‰ä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯è¿æ¥ã€‚</p>
</li>
</ol>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (events[i].data.fd == sockfd)</span><br><span class="line">{</span><br><span class="line">	<span class="comment">// æ¥æ”¶å®¢æˆ·ç«¯ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ–°å¢ç›‘å¬</span></span><br><span class="line">	<span class="built_in">bzero</span>(&amp;ev, <span class="built_in">sizeof</span>(ev));</span><br><span class="line">	ev.data.fd = clientfd;			<span class="comment">// è¯¥ IO å£ä¸ºå®¢æˆ·ç«¯ socket fd</span></span><br><span class="line">	ev.events = EPOLLIN | EPOLLET;	<span class="comment">// å®¢æˆ·ç«¯è¿æ¥ä½¿ç”¨ ET æ¨¡å¼</span></span><br><span class="line">	<span class="built_in">setnonblocking</span>(clientfd);		<span class="comment">// ET éœ€è¦æ­é…éé˜»å¡å¼ socket ä½¿ç”¨</span></span><br><span class="line">	<span class="comment">// å°†å®¢æˆ·ç«¯ socket fd æ³¨å†Œåˆ° epoll</span></span><br><span class="line">	<span class="built_in">epoll_ctl</span>(epfd, EPOLL_CTL_ADD, clientfd, &amp;ev);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ol start="5">
<li>å¦‚æœç›‘å¬å‘ç”Ÿçš„äº‹ä»¶æ˜¯å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”æ˜¯å¯è¯»äº‹ä»¶ï¼Œè¡¨ç¤ºæœ‰å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼š</li>
</ol>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (events[i].events &amp; EPOLLIN)</span><br><span class="line">{</span><br><span class="line">	<span class="keyword">while</span> (<span class="literal">true</span>)	<span class="comment">// éé˜»å¡ IOï¼Œéœ€è¦ä¸æ–­è¯»å–ï¼Œç›´è‡³å®Œæ¯•</span></span><br><span class="line">	{</span><br><span class="line">		<span class="type">ssize_t</span> bytesRead = <span class="built_in">read</span>(events[i].data.fd, buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ­£å¸¸è¯»å–æ•°æ®</span></span><br><span class="line">		<span class="keyword">if</span> (bytesRead &gt; <span class="number">0</span>)</span><br><span class="line">			<span class="comment">// ...</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// å®¢æˆ·ç«¯æ­£å¸¸ä¸­æ–­ï¼Œç»§ç»­è¯»å–</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (bytesRead == <span class="number">-1</span> <span class="keyword">and</span> errno == EINTR)</span><br><span class="line">			<span class="comment">//...</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// éé˜»å¡ IOï¼Œè¿™ä¸ªæ¡ä»¶è¡¨ç¤ºæ•°æ®å…¨éƒ¨è¯»å–å®Œæ¯•</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (bytesRead == <span class="number">-1</span> <span class="built_in">and</span> ((errno == EAGAIN) <span class="built_in">or</span> (errno == EWOULDBLOCK)))</span><br><span class="line">			<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// EOF äº‹ä»¶ï¼Œä¸€èˆ¬è¡¨ç¤ºå®¢æˆ·ç«¯æ–­å¼€è¿æ¥</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (bytesRead == <span class="number">0</span>)</span><br><span class="line">			<span class="comment">// ...</span></span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¯¥èŠ‚ä»£ç ï¼š<a target="_blank" rel="noopener" href="https://github.com/Fingsinz/MakeServerInLinux/tree/master/Day3">Github</a>ï¼Œ<a target="_blank" rel="noopener" href="https://gitee.com/fingsinz/make-server-in-linux/tree/master/Day3">Gitee</a></p>
<h2 id="å››-å°è£…æˆç±»-ç¨‹åºæ¨¡å—åŒ–">å››ã€å°è£…æˆç±»ï¼Œç¨‹åºæ¨¡å—åŒ–</h2>
<h3 id="4-1-å°†socketå’Œinetaddresså°è£…æˆç±»">4.1 å°†socketå’ŒInetAddresså°è£…æˆç±»</h3>
<p>å½“æ–°å»ºæœåŠ¡å™¨ socket æ—¶ï¼Œéœ€è¦å®Œæˆç»‘å®š IP åœ°å€ã€ç›‘å¬ã€æ¥å—å®¢æˆ·ç«¯è¿æ¥ç­‰ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡éƒ½å°è£…æˆ <code>Socket</code> ç±»æ¥å®Œæˆã€‚å¸Œæœ›ç®€åŒ–æˆä»¥ä¸‹æ“ä½œï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–°å»ºæœåŠ¡å™¨ socket</span></span><br><span class="line">Socket *serverSocket = <span class="keyword">new</span> <span class="built_in">Socket</span>();</span><br><span class="line"><span class="comment">// å®ä¾‹åŒ– IP åœ°å€</span></span><br><span class="line">InetAddress *serverAddr = <span class="keyword">new</span> <span class="built_in">InetAddress</span>(<span class="string">"127.0.0.1"</span>, <span class="number">1234</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»‘å®š IP åœ°å€</span></span><br><span class="line">serverSocket-&gt;<span class="built_in">bind</span>(serverAddr);</span><br><span class="line"><span class="comment">// ç›‘å¬</span></span><br><span class="line">serverSocket-&gt;<span class="built_in">listen</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ä¾‹åŒ–ä¸€ä¸ªå®¢æˆ·ç«¯åœ°å€</span></span><br><span class="line">InetAddress *clientAddr = <span class="keyword">new</span> <span class="built_in">InetAddress</span>();</span><br><span class="line"><span class="comment">// æ¥å—ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">Socket *clientSocket = <span class="keyword">new</span> <span class="built_in">Socket</span>(serverSocket-&gt;<span class="built_in">accept</span>(clientAddr));</span><br></pre></td></tr></tbody></table></figure>
<h3 id="4-2-å°†epollå°è£…æˆç±»">4.2 å°†epollå°è£…æˆç±»</h3>
<p>å¯¹äº epollï¼Œå¸Œæœ›ç®€åŒ–æ“ä½œï¼Œå°è£…æˆç±»åï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®ä¾‹åŒ– epoll</span></span><br><span class="line">Epoll *ep = <span class="keyword">new</span> <span class="built_in">Epoll</span>();</span><br><span class="line"><span class="comment">// å°†è¦ç›‘å¬çš„ IO å£æ”¾å…¥ epoll</span></span><br><span class="line">ep-&gt;<span class="built_in">epoll_add</span>(serverSocket-&gt;<span class="built_in">getFd</span>(), EPOLLIN | EPOLLET);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">{</span><br><span class="line">	std::vector&lt;epoll_event&gt; events = ep-&gt;<span class="built_in">poll</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> &amp;ev : events)</span><br><span class="line">		<span class="comment">// å¤„ç†äº‹ä»¶</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="4-3-ç›®å½•ç»“æ„åŠæºä»£ç ">4.3 ç›®å½•ç»“æ„åŠæºä»£ç </h3>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">client.cpp</span><br><span class="line">server.cpp</span><br><span class="line">util.h</span><br><span class="line">util.cpp</span><br><span class="line">Socket.h</span><br><span class="line">Socket.cpp</span><br><span class="line">InetAddress.h</span><br><span class="line">InetAddress.cpp</span><br><span class="line">Epoll.h</span><br><span class="line">Epoll.cpp</span><br></pre></td></tr></tbody></table></figure>
<p>è¯¥èŠ‚ä»£ç ï¼š<a target="_blank" rel="noopener" href="https://github.com/Fingsinz/MakeServerInLinux/tree/master/Day4">Github</a>ï¼Œ<a target="_blank" rel="noopener" href="https://gitee.com/fingsinz/make-server-in-linux/tree/master/Day4">Gitee</a></p>
<h2 id="äº”-å‘ç€reactoræ¨¡å¼è½¬å˜">äº”ã€å‘ç€Reactoræ¨¡å¼è½¬å˜</h2>
<h3 id="5-1-reactorå’Œproactor">5.1 Reactorå’ŒProactor</h3>
<blockquote>
<p>Reactor ç¿»è¯‘è¿‡æ¥çš„æ„æ€æ˜¯ã€Œååº”å †ã€ï¼Œè¿™é‡Œçš„ååº”æŒ‡çš„æ˜¯ã€Œå¯¹äº‹ä»¶ååº”ã€ã€‚</p>
<ul>
<li>å½“æ¥äº†ä¸€ä¸ªäº‹ä»¶ï¼ŒReactor å°±æœ‰ç›¸å¯¹åº”çš„ååº”/å“åº”ã€‚</li>
</ul>
<p>äº‹å®ä¸Šï¼ŒReactor æ¨¡å¼ä¹Ÿå« Dispatcher æ¨¡å¼ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªåå­—æ›´è´´åˆè¯¥æ¨¡å¼çš„å«ä¹‰ï¼Œå³ I/O å¤šè·¯å¤ç”¨ç›‘å¬äº‹ä»¶ã€‚</p>
<ul>
<li>æ”¶åˆ°äº‹ä»¶åï¼Œæ ¹æ®äº‹ä»¶ç±»å‹åˆ†é…ï¼ˆDispatchï¼‰ç»™æŸä¸ªè¿›ç¨‹ / çº¿ç¨‹ã€‚</li>
</ul>
<p>Reactor æ¨¡å¼ä¸»è¦ç”± Reactor å’Œå¤„ç†èµ„æºæ± è¿™ä¸¤ä¸ªæ ¸å¿ƒéƒ¨åˆ†ç»„æˆã€‚</p>
<ul>
<li>Reactor è´Ÿè´£ç›‘å¬å’Œåˆ†å‘äº‹ä»¶ï¼Œäº‹ä»¶ç±»å‹åŒ…å«è¿æ¥äº‹ä»¶ã€è¯»å†™äº‹ä»¶ï¼›</li>
<li>å¤„ç†èµ„æºæ± è´Ÿè´£å¤„ç†äº‹ä»¶ï¼Œå¦‚ read -&gt; ä¸šåŠ¡é€»è¾‘ -&gt; sendï¼›</li>
</ul>
<p>Reactor æ¨¡å¼æ˜¯çµæ´»å¤šå˜çš„ï¼Œå¯ä»¥åº”å¯¹ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œçµæ´»åœ¨äºï¼š</p>
<ul>
<li>Reactor çš„æ•°é‡å¯ä»¥åªæœ‰ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ªï¼›</li>
<li>å¤„ç†èµ„æºæ± å¯ä»¥æ˜¯å•ä¸ªè¿›ç¨‹ / çº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªè¿›ç¨‹ / çº¿ç¨‹ï¼›</li>
</ul>
<p>æœ‰ 3 ä¸ªæ–¹æ¡ˆéƒ½æ˜¯æ¯”è¾ƒç»å…¸çš„ï¼Œä¸”éƒ½æœ‰åº”ç”¨åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼š</p>
<ul>
<li>å• Reactor å•è¿›ç¨‹ / çº¿ç¨‹ï¼›</li>
<li>å• Reactor å¤šçº¿ç¨‹ / è¿›ç¨‹ï¼›</li>
<li>å¤š Reactor å¤šè¿›ç¨‹ / çº¿ç¨‹ï¼›</li>
</ul>
<p>æ–¹æ¡ˆå…·ä½“ä½¿ç”¨è¿›ç¨‹è¿˜æ˜¯çº¿ç¨‹ï¼Œè¦çœ‹ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ä»¥åŠå¹³å°æœ‰å…³ï¼š</p>
<ul>
<li>Java è¯­è¨€ä¸€èˆ¬ä½¿ç”¨çº¿ç¨‹ï¼Œæ¯”å¦‚ Nettyï¼›</li>
<li>C è¯­è¨€ä½¿ç”¨è¿›ç¨‹å’Œçº¿ç¨‹éƒ½å¯ä»¥ï¼Œä¾‹å¦‚ Nginx ä½¿ç”¨çš„æ˜¯è¿›ç¨‹ï¼ŒMemcache ä½¿ç”¨çš„æ˜¯çº¿ç¨‹ã€‚</li>
</ul>
<p>Reactor æ˜¯éé˜»å¡åŒæ­¥ç½‘ç»œæ¨¡å¼ï¼Œæ„ŸçŸ¥çš„æ˜¯å°±ç»ªå¯è¯»å†™äº‹ä»¶ã€‚åœ¨æ¯æ¬¡æ„ŸçŸ¥åˆ°æœ‰äº‹ä»¶å‘ç”Ÿï¼ˆæ¯”å¦‚å¯è¯»å°±ç»ªäº‹ä»¶ï¼‰åï¼Œå°±éœ€è¦åº”ç”¨è¿›ç¨‹ä¸»åŠ¨è°ƒç”¨ read æ–¹æ³•æ¥å®Œæˆæ•°æ®çš„è¯»å–ï¼Œä¹Ÿå°±æ˜¯è¦åº”ç”¨è¿›ç¨‹ä¸»åŠ¨å°† socket æ¥æ”¶ç¼“å­˜ä¸­çš„æ•°æ®è¯»åˆ°åº”ç”¨è¿›ç¨‹å†…å­˜ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼Œè¯»å–å®Œæ•°æ®ååº”ç”¨è¿›ç¨‹æ‰èƒ½å¤„ç†æ•°æ®ã€‚</p>
<p>Proactor æ˜¯å¼‚æ­¥ç½‘ç»œæ¨¡å¼ï¼Œ æ„ŸçŸ¥çš„æ˜¯å·²å®Œæˆçš„è¯»å†™äº‹ä»¶ã€‚åœ¨å‘èµ·å¼‚æ­¥è¯»å†™è¯·æ±‚æ—¶ï¼Œéœ€è¦ä¼ å…¥æ•°æ®ç¼“å†²åŒºçš„åœ°å€ï¼ˆç”¨æ¥å­˜æ”¾ç»“æœæ•°æ®ï¼‰ç­‰ä¿¡æ¯ï¼Œè¿™æ ·ç³»ç»Ÿå†…æ ¸æ‰å¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬æŠŠæ•°æ®çš„è¯»å†™å·¥ä½œå®Œæˆï¼Œè¿™é‡Œçš„è¯»å†™å·¥ä½œå…¨ç¨‹ç”±æ“ä½œç³»ç»Ÿæ¥åšï¼Œå¹¶ä¸éœ€è¦åƒ Reactor é‚£æ ·è¿˜éœ€è¦åº”ç”¨è¿›ç¨‹ä¸»åŠ¨å‘èµ· read/write æ¥è¯»å†™æ•°æ®ï¼Œæ“ä½œç³»ç»Ÿå®Œæˆè¯»å†™å·¥ä½œåï¼Œå°±ä¼šé€šçŸ¥åº”ç”¨è¿›ç¨‹ç›´æ¥å¤„ç†æ•°æ®ã€‚</p>
<p>å› æ­¤ï¼ŒReactor å¯ä»¥ç†è§£ä¸ºã€Œæ¥äº†äº‹ä»¶æ“ä½œç³»ç»Ÿé€šçŸ¥åº”ç”¨è¿›ç¨‹ï¼Œè®©åº”ç”¨è¿›ç¨‹æ¥å¤„ç†ã€ï¼Œè€Œ Proactor å¯ä»¥ç†è§£ä¸ºã€Œæ¥äº†äº‹ä»¶æ“ä½œç³»ç»Ÿæ¥å¤„ç†ï¼Œå¤„ç†å®Œå†é€šçŸ¥åº”ç”¨è¿›ç¨‹ã€ã€‚è¿™é‡Œçš„ã€Œäº‹ä»¶ã€å°±æ˜¯æœ‰æ–°è¿æ¥ã€æœ‰æ•°æ®å¯è¯»ã€æœ‰æ•°æ®å¯å†™çš„è¿™äº› I/O äº‹ä»¶è¿™é‡Œçš„ã€Œå¤„ç†ã€åŒ…å«ä»é©±åŠ¨è¯»å–åˆ°å†…æ ¸ä»¥åŠä»å†…æ ¸è¯»å–åˆ°ç”¨æˆ·ç©ºé—´ã€‚</p>
<p>ä½œè€…ï¼šå°æ—coding<br>
é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/26943938/answer/1856426252">https://www.zhihu.com/question/26943938/answer/1856426252</a><br>
æ¥æºï¼šçŸ¥ä¹è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚</p>
</blockquote>
<p><em>è¯¦ç»†è¯·å‚è€ƒæ¸¸åŒã€ŠLinuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‹ç¬¬å…«ç« ç¬¬å››èŠ‚ã€é™ˆç¡•ã€ŠLinuxå¤šçº¿ç¨‹æœåŠ¡å™¨ç¼–ç¨‹ã€‹ç¬¬å…­ç« ç¬¬å…­èŠ‚ã€‚</em></p>
<p>æ¥ä¸‹æ¥è¦å°†æœåŠ¡å™¨å‘ç€ Reactor æ¨¡å¼è½¬å˜ï¼š</p>
<ol>
<li>é¦–å…ˆå°†æ•´ä¸ªæœåŠ¡å™¨æŠ½è±¡æˆä¸€ä¸ª Server ç±»ï¼Œè¿™ä¸ªç±»ä¸­æœ‰ä¸€ä¸ª main-Reactorï¼Œé‡Œé¢çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ª EventLoopï¼Œè¿™æ˜¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼›</li>
<li>æ·»åŠ éœ€è¦ç›‘å¬çš„äº‹åŠ¡åˆ°è¿™ä¸ªäº‹ä»¶å¾ªç¯å†…ï¼Œæ¯æ¬¡æœ‰äº‹ä»¶å‘ç”Ÿæ—¶å°±ä¼šé€šçŸ¥ï¼Œåœ¨ç¨‹åºä¸­è¿”å›ç»™ Channelï¼ˆè‡ªå°è£…çš„ç±»ï¼‰ï¼Œç„¶åæ ¹æ®ä¸åŒçš„æè¿°ç¬¦ã€äº‹ä»¶ç±»å‹ä»¥å›è°ƒå‡½æ•°çš„æ–¹å¼è¿›è¡Œå¤„ç†ã€‚</li>
</ol>
<h3 id="5-2-åŠ å…¥channelç±»">5.2 åŠ å…¥Channelç±»</h3>
<p>é¢å¯¹æœåŠ¡å™¨è®¸å¤šæœåŠ¡æ—¶ï¼Œä¸åŒçš„è¿æ¥ç±»å‹ä¹Ÿå°†å†³å®šä¸åŒçš„å¤„ç†é€»è¾‘ï¼Œä»…ä»…é€šè¿‡ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ¥åŒºåˆ†æ˜¾ç„¶ä¼šå¾ˆéº»çƒ¦ã€‚å¸Œæœ›å¾—åˆ°æ–‡ä»¶æè¿°ç¬¦çš„æ›´å¤šæ¶ˆæ¯ã€‚</p>
<ul>
<li>epoll çš„ <code>epoll_event</code> ç»“æ„ä½“ä¸­ï¼Œ<code>data</code> å­—æ®µå¯ä»¥æ”¾ä¸€ä¸ª <code>void *</code> ç±»å‹çš„æŒ‡é’ˆï¼Œç”¨æ¥ä¿å­˜æ›´å¤šä¿¡æ¯ã€‚</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">union</span> <span class="title class_">epoll_data</span></span><br><span class="line">{</span><br><span class="line">  <span class="type">void</span> *ptr;</span><br><span class="line">  <span class="type">int</span> fd;</span><br><span class="line">  <span class="type">uint32_t</span> u32;</span><br><span class="line">  <span class="type">uint64_t</span> u64;</span><br><span class="line">} <span class="type">epoll_data_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">epoll_event</span></span><br><span class="line">{</span><br><span class="line">  <span class="type">uint32_t</span> events;		<span class="comment">/* Epoll events */</span></span><br><span class="line">  <span class="type">epoll_data_t</span> data;	<span class="comment">/* User data variable */</span></span><br><span class="line">} __EPOLL_PACKED;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>epoll ä¸­çš„ <code>data</code> æ˜¯ä¸€ä¸ªè”åˆç±»å‹ï¼š
<ul>
<li>å¯ä»¥å­˜å‚¨ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä»»ä½•ä¸€ä¸ªåœ°å€å—çš„å†…å®¹ï¼›</li>
<li>å¯ä»¥æ˜¯ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œå°±æ­¤å°†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å°è£…æˆä¸€ä¸ª <code>Channel</code> ç±»ï¼Œä¸€ä¸ª <code>Channel</code> ç±»å§‹ç»ˆè´Ÿè´£ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚å¯¹ä¸åŒçš„æœåŠ¡ã€ä¸åŒçš„äº‹ä»¶ç±»å‹ï¼Œéƒ½å¯ä»¥åœ¨ç±»ä¸­è¿›è¡Œå¤„ç†ã€‚</li>
</ul>
</li>
</ul>
<p>è®¾è®¡ <code>Channel</code> ç±»ï¼Œæ ¸å¿ƒæˆå‘˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Channel</span></span><br><span class="line">{</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	EventLoop *loop;</span><br><span class="line">	<span class="type">int</span> fd;</span><br><span class="line">	<span class="type">uint32_t</span> events;</span><br><span class="line">	<span class="type">uint32_t</span> revents;</span><br><span class="line">	<span class="type">bool</span> isEpoll;</span><br><span class="line">	std::function&lt;<span class="type">void</span>()&gt; callback;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>loop</code>ï¼šæŒ‡å‘ä¸ä¹‹å…³è”çš„äº‹ä»¶å¾ªç¯çš„æŒ‡é’ˆã€‚</li>
<li><code>fd</code>ï¼šChannel è´Ÿè´£çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</li>
<li><code>events</code>ï¼šè¡¨ç¤ºå¸Œæœ›ç›‘å¬è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„å“ªäº›äº‹ä»¶ã€‚</li>
<li><code>revents</code>ï¼šè¡¨ç¤ºåœ¨ <code>epoll</code> è¿”å›è¯¥ <code>Channel</code> æ—¶æ–‡ä»¶æè¿°ç¬¦æ­£åœ¨å‘ç”Ÿçš„äº‹ä»¶ã€‚</li>
<li><code>isEpoll</code>ï¼šè¡¨ç¤ºå½“å‰ <code>Channel</code> æ˜¯å¦å·²ç»æ·»åŠ åˆ° <code>epoll</code> çº¢é»‘æ ‘ä¸­ï¼ŒåŒºåˆ†ä½¿ç”¨ <code>EPOLL_CTL_ADD</code> è¿˜æ˜¯ <code>EPOLL_CTL_MOD</code>ã€‚</li>
<li><code>callback</code>ï¼šå‘ç”Ÿäº‹ä»¶æ—¶æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚</li>
</ul>
<p>æ·»åŠ  Channel ç±»å¯ä»¥æ›´åŠ æ–¹ä¾¿ç®€å•ã€å¤šæ ·åŒ–åœ°å¤„ç† epoll ä¸­å‘ç”Ÿçš„äº‹ä»¶ã€‚åŒæ—¶è„±ç¦»äº†åº•å±‚ï¼Œå°† epollã€æ–‡ä»¶æè¿°ç¬¦å’Œäº‹ä»¶è¿›è¡Œäº†æŠ½è±¡ï¼Œå½¢æˆäº†äº‹ä»¶åˆ†å‘çš„æ¨¡å‹ï¼Œè¿™ä¹Ÿæ˜¯ Reactor æ¨¡å¼çš„æ ¸å¿ƒã€‚</p>
<h3 id="5-3-åŠ å…¥eventloopç±»">5.3 åŠ å…¥EventLoopç±»</h3>
<p>EventLoop ç±»çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EventLoop</span> {</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Epoll *ep;</span><br><span class="line">    <span class="type">bool</span> quit;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">EventLoop</span>();</span><br><span class="line">    ~<span class="built_in">EventLoop</span>();</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">updateChannel</span><span class="params">(Channel*)</span></span>;</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>ep</code>ï¼šæŒ‡å‘Epollç±»å®ä¾‹çš„æŒ‡é’ˆï¼›</li>
<li><code>quit</code>ï¼šæŒ‡ç¤ºç¨‹åºæ˜¯å¦åº”è¯¥é€€å‡ºï¼›</li>
<li><code>loop()</code>ï¼šäº‹ä»¶å¾ªç¯å‡½æ•°ï¼Œè°ƒç”¨å¼€å§‹äº‹ä»¶é©±åŠ¨ï¼Œå³åŸæ¥è°ƒç”¨ <code>epoll_wait</code> å‡½æ•°çš„æ­»å¾ªç¯ï¼›</li>
<li><code>updateChannel()</code>ï¼šæ›´æ–° Channelã€‚</li>
</ul>
<p>å°†éœ€è¦ç›‘å¬çš„äº‹åŠ¡åŠ å…¥åˆ°äº‹ä»¶å¾ªç¯ä¸­ï¼Œæ¯æ¬¡æœ‰äº‹ä»¶å‘ç”Ÿå°±ä¼šé€šçŸ¥ï¼Œè¿”å›åˆ° Channelï¼Œç„¶åæ ¹æ®ä¸åŒçš„æè¿°ç¬¦ã€äº‹ä»¶ç±»å‹ä»¥å›è°ƒå‡½æ•°æ–¹å¼è¿›è¡Œå¤„ç†ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">EventLoop::loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">while</span> (!quit)</span><br><span class="line">	{</span><br><span class="line">		<span class="comment">// ä½¿ç”¨epollå®ä¾‹è½®è¯¢äº‹ä»¶</span></span><br><span class="line">		std::vector&lt;Channel *&gt; channels = ep-&gt;<span class="built_in">poll</span>();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¤„ç†æ¯ä¸ªChannelçš„äº‹ä»¶</span></span><br><span class="line">		<span class="keyword">for</span> (Channel *channel : channels)</span><br><span class="line">			channel-&gt;<span class="built_in">handleEvent</span>();</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="5-4-åŠ å…¥serverç±»">5.4 åŠ å…¥Serverç±»</h3>
<p>æœåŠ¡å™¨ç±» <code>Server</code> çš„æ ¸å¿ƒæˆå‘˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Server</span></span><br><span class="line">{</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    EventLoop *loop;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Server</span>(EventLoop*);</span><br><span class="line">    ~<span class="built_in">Server</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handleReadEvent</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">newConnection</span><span class="params">(Socket *serv_sock)</span></span>;</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>loop</code>ï¼šäº‹ä»¶å¾ªç¯å¯¹è±¡ã€‚</li>
<li><code>handleReadEvent()</code>ï¼šå¤„ç†è¯»äº‹ä»¶ã€‚</li>
<li><code>newConnection()</code>ï¼šå¤„ç†æ–°è¿æ¥ã€‚</li>
</ul>
<p>ä¹‹åå¯åŠ¨æœåŠ¡å™¨çš„æ“ä½œæŠ½è±¡ä¸ºï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EventLoop *loop = <span class="keyword">new</span> <span class="built_in">EventLoop</span>();</span><br><span class="line">Server *server = <span class="keyword">new</span> <span class="built_in">Server</span>(loop);</span><br><span class="line">loop-&gt;<span class="built_in">loop</span>();</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™ä¸ªç‰ˆæœ¬æœåŠ¡å™¨å†…åªæœ‰ä¸€ä¸ª <code>EventLoop</code>ï¼Œå½“å…¶ä¸­æœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå¯ä»¥æ‹¿åˆ°è¯¥æè¿°ç¬¦å¯¹åº”çš„ <code>Channel</code>ã€‚</p>
<p>åœ¨æ–°å»º Channel æ—¶ï¼Œæ ¹æ® Channel æè¿°ç¬¦çš„ä¸åŒåˆ†åˆ«ç»‘å®šäº†ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼š</p>
<ul>
<li><code>newConnection()</code> å‡½æ•°è¢«ç»‘å®šåˆ°æœåŠ¡å™¨socketä¸Šï¼›
<ul>
<li>å¦‚æœæœåŠ¡å™¨ socket æœ‰å¯è¯»äº‹ä»¶ï¼ŒChannel é‡Œçš„ <code>handleEvent()</code> å‡½æ•°å®é™…ä¸Šä¼šè°ƒç”¨ Server ç±»çš„ <code>newConnection()</code> æ–°å»ºè¿æ¥ã€‚</li>
</ul>
</li>
<li><code>handlrReadEvent()</code> è¢«ç»‘å®šåˆ°æ–°æ¥å—çš„å®¢æˆ·ç«¯socketä¸Šã€‚
<ul>
<li>å¦‚æœå®¢æˆ·ç«¯ socket æœ‰å¯è¯»äº‹ä»¶ï¼ŒChannel é‡Œçš„ <code>handleEvent()</code> å‡½æ•°å®é™…ä¸Šä¼šè°ƒç”¨ Server ç±»çš„ <code>handleReadEvent()</code> å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚</li>
</ul>
</li>
</ul>
<p>è‡³æ­¤ï¼Œæ ¹æ®æŠ½è±¡å‡ºçš„ <code>EventLoop</code> å’Œ <code>Channel</code>ï¼Œæ„æˆäº†äº‹ä»¶é©±åŠ¨æ¨¡å‹ã€‚è¿™ä¸¤ä¸ªç±»å’ŒæœåŠ¡å™¨æ ¸å¿ƒ <code>Server</code> å·²ç»æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œç»è¿‡å®Œå–„åå¯ä»¥è¢«ä»»ä½•ç¨‹åºå¤ç”¨ï¼Œè¾¾åˆ°äº†äº‹ä»¶é©±åŠ¨çš„è®¾è®¡æ€æƒ³ï¼Œç°åœ¨çš„æœåŠ¡å™¨ä¹Ÿå¯ä»¥çœ‹æˆä¸€ä¸ªæœ€ç®€æ˜“çš„ Reactor æ¨¡å¼æœåŠ¡å™¨ã€‚</p>
<p><em>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›®å‰è¯¥æœåŠ¡å™¨çš„å†…å­˜ç®¡ç†ä¸€å¡Œç³Šæ¶‚ã€‚</em></p>
<p>è¯¥èŠ‚ä»£ç ï¼š<a target="_blank" rel="noopener" href="https://github.com/Fingsinz/MakeServerInLinux/tree/master/Day5">Github</a>ï¼Œ<a target="_blank" rel="noopener" href="https://gitee.com/fingsinz/make-server-in-linux/tree/master/Day5">Gitee</a></p>
</div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2024-03-22</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« Fingsinz</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/C/'>
                            C++
                        </a>
                    
                        <a href='/tags/Linux/'>
                            Linux
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/%E7%AC%94%E8%AE%B0/'>
                            ç¬”è®°
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    <!-- <div class="post-footer-pre-next">
        <span>ä¸Šä¸€ç¯‡ï¼š<a href=""></a></span>
        <span class="post-footer-pre-next-last-span-right">ä¸Šä¸€ç¯‡ï¼š<a href=""></a></span>
    </div> -->

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â©2023-2024 

            
                

            
                
                    / <a href="/"> Fingsinz&#39;s Space </a>
                

            
                
                    / <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/fingsinz"> çŸ¥ä¹ </a>
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>æˆ‘åœ¨æƒ³ï¼Œæ—¶ä¸‹ä½ æ‰€éœ€è¦çš„ï¼Œåº”è¯¥æ˜¯ç—›ç—›å¿«å¿«æ¢ä¸ªå¿ƒæƒ…ï¼Œå¹²å¹²è„†è„†äº«å—äººç”Ÿã€‚</span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery.min.js"></script>



                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
    </body>


</html>